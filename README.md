# MOEX Analytics - Аналитика торговых данных Московской биржи

## Описание проекта

Распределенная система обработки данных для анализа торговых данных Московской биржи. Проект реализует полный цикл ETL: сбор данных через API MOEX, распределенная обработка с Dask, хранение результатов и интерактивная визуализация.

## Технологический стек

- **Prefect** - оркестрация ETL-пайплайна
- **Dask** - распределенная обработка данных
- **Pandas** - анализ данных
- **Streamlit** - веб-интерфейс для визуализации
- **Plotly** - интерактивные графики
- **MOEX ISS API** - источник данных

## Структура проекта

```
moex_analytics/
├── data/                           # Данные (создается автоматически)
│   ├── moex_raw_data.csv          # Сырые данные с биржи
│   ├── moex_processed_daily.csv   # Обработанные дневные данные
│   └── moex_processed_weekly.csv  # Агрегированные недельные данные
├── flows/                          # Prefect flows
│   ├── extract_moex.py            # Сбор данных с MOEX API
│   └── main_flow.py               # Главный ETL пайплайн
├── dask_jobs/                      # Обработка данных с Dask
│   └── transform.py               # Очистка и расчет индикаторов
├── dashboards/                     # Визуализация
│   ├── streamlit_app.py           # Веб-приложение
│   └── analysis.ipynb             # Jupyter ноутбук
├── requirements.txt               # Зависимости Python
└── README.md                      # Документация
```

## Установка

### Требования

- Python 3.11+
- pip

### Установка зависимостей

```bash
pip install -r requirements.txt
```

### Создание папки для данных

```bash
mkdir data
```

## Запуск проекта

### Шаг 1: Запуск Dask кластера

Откройте два терминала:

**Терминал 1 - Dask Scheduler:**
```bash
dask-scheduler
```

**Терминал 2 - Dask Workers:**
```bash
dask-worker localhost:8786
```

Dask Dashboard доступен по адресу: http://localhost:8787

### Шаг 2: Запуск ETL пайплайна

Откройте третий терминал:

```bash
python flows/main_flow.py --dask
```

### Шаг 3: Визуализация данных

После выполнения ETL запустите веб-приложение:

```bash
streamlit run dashboards/streamlit_app.py
```

Приложение откроется по адресу: http://localhost:8501

## Описание процесса обработки

### 1. Extract (Сбор данных)

Скрипт `flows/extract_moex.py` получает исторические данные торгов для 30 акций за последний год через публичный API Московской биржи:

- Цены открытия, закрытия, максимум, минимум
- Объемы торгов
- Период: последние 365 дней

### 2. Transform (Обработка данных)

Скрипт `dask_jobs/transform.py` выполняет распределенную обработку через Dask кластер:

- Очистку данных (удаление пропусков, дубликатов)
- Расчет технических индикаторов:
  - Дневная доходность
  - Скользящие средние (7 и 30 дней)
  - Волатильность
  - Изменение объема торгов
- Агрегация по неделям

### 3. Load (Сохранение результатов)

Обработанные данные сохраняются в CSV файлы:
- `data/moex_processed_daily.csv` - дневные данные
- `data/moex_processed_weekly.csv` - недельные данные

### 4. Visualize (Визуализация)

Streamlit приложение предоставляет:
- Интерактивные графики динамики цен
- Свечные графики с индикаторами
- Сравнение волатильности и доходности
- Risk-Return диаграммы
- Корреляционные матрицы
- Фильтры по акциям и датам
- Экспорт данных

## Запуск отдельных компонентов

### Только сбор данных:
```bash
python flows/extract_moex.py
```

### Только обработка данных (требуется запущенный Dask кластер):
```bash
python dask_jobs/transform.py --cluster
```
